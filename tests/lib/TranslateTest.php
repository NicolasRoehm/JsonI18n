<?php

namespace JsonI18n\Tests;

use \JsonI18n\Translate;

require_once dirname(__FILE__) . '/../../lib/Translate.php';

/**
 * Generated by PHPUnit_SkeletonGenerator 1.2.1 on 2014-03-21 at 04:27:25.
 * @ignore No phpDoc required for test cases.
 */
class TranslateTest extends \PHPUnit_Framework_TestCase {

    /**
     * @var JsonI18n
     */
    protected $object;
    
    /**
     * Some sample array data
     * @var array
     */
    protected $arr = array(
        array('headsign_en' => 'University', 'headsign_fr' => 'Université'),
        array('headsign_en' => 'College', 'headsign_fr' => 'Collège'),
        array('headsign_en' => 'Airport', 'headsign_fr' => 'Aéroport')
    );

    /**
     * Sets up the fixture, for example, opens a network connection.
     * This method is called before a test is executed.
     */
    protected function setUp() {
        $this->object = new Translate('en-CA');
    }

    /**
     * Tears down the fixture, for example, closes a network connection.
     * This method is called after a test is executed.
     */
    protected function tearDown() {
        
    }
    
    /**
     * @covers JsonI18n\Translate::__construct
     */
    public function testDefaultConstructor() {
        $obj2 = new Translate('en-CA');
        
        $this->assertEquals(\PHPUnit_Framework_Assert::readAttribute($obj2, 'lang'), 'en-CA');
    }
    
    /**
     * @covers JsonI18n\Translate::__construct
     * @expectedException \PHPUnit_Framework_Error_Warning
     */
    public function testConstructorFail() {
        new Translate();
    }
    
    /**
     * @covers JsonI18n\Translate::__construct
     * @expectedException \InvalidArgumentException
     * @expectedExceptionMessage Invalid language.
     */
    public function testConstructorInvalidLanguage() {
        new Translate('');
    }

    /**
     * @covers JsonI18n\Translate::addResource
     */
    public function testAddResource() {
        $this->object->addResource(dirname(__FILE__) . '/../resources/test.json');

        $this->assertArrayHasKey('values', \PHPUnit_Framework_Assert::readAttribute($this->object, 'data'));
        $this->assertArrayHasKey('arrayGroups', \PHPUnit_Framework_Assert::readAttribute($this->object, 'data'));
    }
    
    /**
     * @covers JsonI18n\Translate::addResource
     * @expectedException PHPUnit_Framework_Error_Warning
     */
    public function testAddResourceInvalidFile() {
        $this->object->addResource('');
    }
    
    /**
     * @covers JsonI18n\Translate::addResource
     */
    public function testAddMultipleResources() {
        $this->object->addResource(dirname(__FILE__) . '/../resources/test.json');
        $this->object->addResource(dirname(__FILE__) . '/../resources/global.json');

        $this->object->debug();
        
        $this->assertEquals($this->object->__('documentTitleTag'), 'Routes and maps');
        $this->assertEquals($this->object->__('documentTitleTag', 'fr-CA'), 'Circuits et cartes');
        $this->assertEquals($this->object->__('goodbye'), 'Have a good day!');
        $this->assertEquals($this->object->__('goodbye', 'fr-CA'), 'Bonne journée!');
    }

    /**
     * @covers JsonI18n\Translate::getLanguage
     */
    public function testGetLanguage() {
        $this->assertEquals($this->object->getLanguage(), 'en-CA');
    }

    /**
     * @covers JsonI18n\Translate::__
     */
    public function test__() {
        $this->object->addResource(dirname(__FILE__) . '/../resources/test.json');

        $this->assertEquals($this->object->__('documentTitleTag'), 'Quick planner');
        $this->assertEquals($this->object->__('documentTitleTag', 'fr-CA'), 'Planificateur rapide');
    }
    
    /**
     * @covers JsonI18n\Translate::__
     * @expectedException \OutOfBoundsException
     * @expectedExceptionMessage Invalid language: zh-CN
     */
    public function test__InvalidLanguage() {
        $this->object->addResource(dirname(__FILE__) . '/../resources/test.json');
        $this->object->__('documentTitleTag', 'zh-CN');
    }
    
    /**
     * @covers JsonI18n\Translate::__
     * @expectedException \OutOfBoundsException
     * @expectedExceptionMessage Invalid key: null
     */
    public function test__InvalidKey() {
        $this->object->addResource(dirname(__FILE__) . '/../resources/test.json');
        $this->object->__('null');
    }

    /**
     * @covers JsonI18n\Translate::_f
     */
    public function test_f() {
        $this->object->addResource(dirname(__FILE__) . '/../resources/test.json');

        $this->assertEquals($this->object->_f('destination', 'Kanata'), 'Destination: Kanata');
        $this->assertEquals($this->object->_f('numBuses', 2), 'You will need to transfer 2 time(s).');
        $this->assertEquals($this->object->_f('instructionTake', array(95, 'Campus Station', '18:01')), 'Board the 95 at Campus Station at 18:01.');

        $this->assertEquals($this->object->_f('destination', 'Kanata', 'fr-CA'), 'Destination : Kanata');
        $this->assertEquals($this->object->_f('numBuses', 2, 'fr-CA'), 'Vous devez transferer 2 fois.');
        $this->assertEquals($this->object->_f('instructionTake', array(95, 'Station Campus', '18h01'), 'fr-CA'), 'Embarquer le 95 à Station Campus à 18h01.');
        
        $this->assertEquals($this->object->_f('destination', NULL), 'Destination: ');
        $this->assertEquals($this->object->_f('numBuses', NULL), 'You will need to transfer 0 time(s).');
    }
    
    /**
     * @covers JsonI18n\Translate::_f
     * @expectedException \OutOfBoundsException
     * @expectedExceptionMessage Invalid language: zh-CN
     */
    public function test_fInvalidLanguage() {
        $this->object->addResource(dirname(__FILE__) . '/../resources/test.json');
        $this->object->_f('numBuses', 0, 'zh-CN');
    }
    
    /**
     * @covers JsonI18n\Translate::_f
     * @expectedException \OutOfBoundsException
     * @expectedExceptionMessage Invalid key: null
     */
    public function test_fInvalidKey() {
        $this->object->addResource(dirname(__FILE__) . '/../resources/test.json');
        $this->object->_f('null', 0);
    }
    
    /**
     * @covers JsonI18n\Translate::_f
     * @expectedException \InvalidArgumentException
     */
    public function test_fInvalidStrings() {
        $this->object->addResource(dirname(__FILE__) . '/../resources/test.json');
        $this->object->_f('numBuses', true);
    }

    /**
     * @covers JsonI18n\Translate::localizeArray
     */
    public function testLocalizeArray() {
        $this->object->addResource(dirname(__FILE__) . '/../resources/test.json');
        
        $arr1 = $this->arr;
        $arr2 = $this->arr;
        
        $this->object->localizeArray($arr1, 'headsign', 'en-CA');
        $this->object->localizeArray($arr2, 'headsign', 'fr-CA');
        
        $this->assertEquals($arr1, array(
            array('headsign' => 'University'),
            array('headsign' => 'College'),
            array('headsign' => 'Airport')
        ));
        
        $this->assertEquals($arr2, array(
            array('headsign' => 'Université'),
            array('headsign' => 'Collège'),
            array('headsign' => 'Aéroport')
        ));
    }
    
    /**
     * @covers JsonI18n\Translate::localizeArray
     * @expectedException \OutOfBoundsException
     * @expectedExceptionMessage Invalid group: endpoint
     */
    public function testLocalizeArrayInvalidGroup() {
        $this->object->addResource(dirname(__FILE__) . '/../resources/test.json');
        
        $this->object->localizeArray($this->arr, 'endpoint', 'en-CA');
    }
    
    /**
     * @covers JsonI18n\Translate::localizeArray
     * @expectedException \OutOfBoundsException
     * @expectedExceptionMessage Invalid language: zh-CN
     */
    public function testLocalizeArrayInvalidLanguage() {
        $this->object->addResource(dirname(__FILE__) . '/../resources/test.json');
        
        $this->object->localizeArray($this->arr, 'headsign', 'zh-CN');
    }
    
    /**
     * @covers JsonI18n\Translate::localizeArray
     * @expectedException \OutOfBoundsException
     * @expectedExceptionMessage Invalid array index: invalid
     */
    public function testLocalizeArrayInvalidIndex() {
        $this->object->addResource(dirname(__FILE__) . '/../resources/test.json');
        
        $this->object->localizeArray($this->arr, 'headsign', 'en-US');
    }

}